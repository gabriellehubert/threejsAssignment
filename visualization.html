<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Packet Visualization</title>
		<style>
			body { margin: 0; }
			canvas { display: block; }
		</style>
		<link rel="stylesheet" type="text/css" href="css/visualization.css">
	</head>
	<body>
		<script src="js/three.js"></script>
		<div id="data" style="display: none;">
[
 {
   "No.": 1,
   "Time": 0,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 76
 },
 {
   "No.": 2,
   "Time": 0.000003,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 76
 },
 {
   "No.": 3,
   "Time": 0.001005,
   "Source": "211.137.137.11",
   "Destination": "89.128.123.34",
   "Protocol": "UDP",
   "Length": 80
 },
 {
   "No.": 4,
   "Time": 0.001014,
   "Source": "192.168.2.101",
   "Destination": "228.192.164.90",
   "Protocol": "UDP",
   "Length": 68
 },
 {
   "No.": 5,
   "Time": 0.001016,
   "Source": "209.137.115.112",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 68
 },
 {
   "No.": 6,
   "Time": 0.001034,
   "Source": "192.168.2.101",
   "Destination": "192.66.35.30",
   "Protocol": "CMPP",
   "Length": 107
 },
 {
   "No.": 7,
   "Time": 0.001036,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 107
 },
 {
   "No.": 8,
   "Time": 0.076268,
   "Source": "211.137.137.11",
   "Destination": "173.250.83.176",
   "Protocol": "UDP",
   "Length": 68
 },
 {
   "No.": 9,
   "Time": 0.790971,
   "Source": "192.168.2.101",
   "Destination": "192.66.35.30",
   "Protocol": "CMPP",
   "Length": 80
 },
 {
   "No.": 10,
   "Time": 0.790974,
   "Source": "192.66.35.30",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 80
 },
 {
   "No.": 11,
   "Time": 0.866288,
   "Source": "192.66.35.30",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 12,
   "Time": 1.576453,
   "Source": "148.167.18.178",
   "Destination": "192.168.2.101",
   "Protocol": "CMPP",
   "Length": 98
 },
 {
   "No.": 13,
   "Time": 1.576461,
   "Source": "209.137.115.112",
   "Destination": "89.128.123.34",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 14,
   "Time": 1.576463,
   "Source": "134.211.182.5",
   "Destination": "209.137.115.112",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 15,
   "Time": 1.57693,
   "Source": "192.168.2.101",
   "Destination": "134.211.182.5",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 16,
   "Time": 1.576931,
   "Source": "173.250.83.176",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 17,
   "Time": 1.577472,
   "Source": "173.250.83.176",
   "Destination": "10.113.43.220",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 18,
   "Time": 1.596435,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 90
 },
 {
   "No.": 19,
   "Time": 3.038219,
   "Source": "10.113.43.220",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 76
 },
 {
   "No.": 20,
   "Time": 3.038221,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 76
 },
 {
   "No.": 21,
   "Time": 3.039325,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 80
 },
 {
   "No.": 22,
   "Time": 3.039335,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 23,
   "Time": 3.039336,
   "Source": "10.113.43.220",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 24,
   "Time": 3.039347,
   "Source": "192.168.2.101",
   "Destination": "10.113.43.220",
   "Protocol": "CMPP",
   "Length": 107
 },
 {
   "No.": 25,
   "Time": 3.039349,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 107
 },
 {
   "No.": 26,
   "Time": 3.106431,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 27,
   "Time": 3.98135,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "CMPP",
   "Length": 80
 },
 {
   "No.": 28,
   "Time": 3.981353,
   "Source": "192.168.2.101",
   "Destination": "192.66.35.30",
   "Protocol": "TCP",
   "Length": 80
 },
 {
   "No.": 29,
   "Time": 4.056522,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 30,
   "Time": 6.647465,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "CMPP",
   "Length": 98
 },
 {
   "No.": 31,
   "Time": 6.647474,
   "Source": "192.168.2.101",
   "Destination": "192.66.35.30",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 32,
   "Time": 6.647477,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 33,
   "Time": 6.647817,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 34,
   "Time": 6.647819,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 35,
   "Time": 6.648481,
   "Source": "211.137.137.11",
   "Destination": "232.254.166.201",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 36,
   "Time": 6.667406,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 90
 },
 {
   "No.": 37,
   "Time": 10.9135,
   "Source": "28.13.251.190",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 76
 },
 {
   "No.": 38,
   "Time": 10.913503,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 76
 },
 {
   "No.": 39,
   "Time": 10.91456,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 80
 },
 {
   "No.": 40,
   "Time": 10.91457,
   "Source": "28.13.251.190",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 68
 },
 {
   "No.": 41,
   "Time": 10.914571,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 68
 },
 {
   "No.": 42,
   "Time": 10.914583,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "CMPP",
   "Length": 107
 },
 {
   "No.": 43,
   "Time": 10.914585,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 107
 },
 {
   "No.": 44,
   "Time": 11.016866,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "UDP",
   "Length": 68
 },
 {
   "No.": 45,
   "Time": 11.717538,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "CMPP",
   "Length": 98
 },
 {
   "No.": 46,
   "Time": 11.717543,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 68
 },
 {
   "No.": 47,
   "Time": 11.717544,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 48,
   "Time": 11.717681,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "CMPP",
   "Length": 80
 },
 {
   "No.": 49,
   "Time": 11.717685,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 80
 },
 {
   "No.": 50,
   "Time": 11.717949,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 51,
   "Time": 11.717951,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "DNS",
   "Length": 68
 },
 {
   "No.": 52,
   "Time": 11.718542,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 53,
   "Time": 11.757422,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "DNS",
   "Length": 90
 },
 {
   "No.": 54,
   "Time": 16.759253,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 76
 },
 {
   "No.": 55,
   "Time": 16.759255,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 76
 },
 {
   "No.": 56,
   "Time": 16.760282,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 80
 },
 {
   "No.": 57,
   "Time": 16.76029,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 58,
   "Time": 16.760292,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "DNS",
   "Length": 68
 },
 {
   "No.": 59,
   "Time": 16.760306,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "CMPP",
   "Length": 107
 },
 {
   "No.": 60,
   "Time": 16.760307,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 107
 },
 {
   "No.": 61,
   "Time": 16.827307,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "DNS",
   "Length": 68
 },
 {
   "No.": 62,
   "Time": 17.758231,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "CMPP",
   "Length": 80
 },
 {
   "No.": 63,
   "Time": 17.758234,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 80
 },
 {
   "No.": 64,
   "Time": 17.827405,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 65,
   "Time": 21.79888,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "CMPP",
   "Length": 98
 },
 {
   "No.": 66,
   "Time": 21.798888,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 67,
   "Time": 21.79889,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 68,
   "Time": 21.799188,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "DNS",
   "Length": 68
 },
 {
   "No.": 69,
   "Time": 21.79919,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 70,
   "Time": 21.799767,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 71,
   "Time": 21.818379,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 90
 },
 {
   "No.": 72,
   "Time": 21.819246,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 76
 },
 {
   "No.": 73,
   "Time": 21.819248,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 76
 },
 {
   "No.": 74,
   "Time": 21.820267,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 80
 },
 {
   "No.": 75,
   "Time": 21.820276,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 76,
   "Time": 21.820278,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.10",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 77,
   "Time": 21.820288,
   "Source": "192.168.3.101",
   "Destination": "211.137.137.11",
   "Protocol": "CMPP",
   "Length": 107
 },
 {
   "No.": 78,
   "Time": 21.82029,
   "Source": "192.168.2.101",
   "Destination": "212.137.137.11",
   "Protocol": "TCP",
   "Length": 107
 },
 {
   "No.": 79,
   "Time": 21.887628,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 80,
   "Time": 22.038003,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "CMPP",
   "Length": 98
 },
 {
   "No.": 81,
   "Time": 22.038007,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 82,
   "Time": 22.038009,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 83,
   "Time": 23.034542,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "CMPP",
   "Length": 80
 },
 {
   "No.": 84,
   "Time": 23.034544,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 80
 },
 {
   "No.": 85,
   "Time": 23.057772,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "CMPP",
   "Length": 81
 },
 {
   "No.": 86,
   "Time": 23.057778,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 87,
   "Time": 23.057779,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 88,
   "Time": 53.984482,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "CMPP",
   "Length": 80
 },
 {
   "No.": 89,
   "Time": 53.984484,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 80
 },
 {
   "No.": 90,
   "Time": 53.994645,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "CMPP",
   "Length": 81
 },
 {
   "No.": 91,
   "Time": 53.994652,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 92,
   "Time": 53.994653,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 93,
   "Time": 84.986436,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "CMPP",
   "Length": 80
 },
 {
   "No.": 94,
   "Time": 84.986439,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 80
 },
 {
   "No.": 95,
   "Time": 85.0124,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "CMPP",
   "Length": 81
 },
 {
   "No.": 96,
   "Time": 85.012405,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "TCP",
   "Length": 68
 },
 {
   "No.": 97,
   "Time": 85.012406,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 68
 },
 {
   "No.": 98,
   "Time": 115.988375,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "CMPP",
   "Length": 80
 },
 {
   "No.": 99,
   "Time": 115.988377,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 80
 },
 {
   "No.": 100,
   "Time": 116.014377,
   "Source": "211.137.137.11",
   "Destination": "192.168.2.101",
   "Protocol": "CMPP",
   "Length": 81
 },
 {
   "No.": 101,
   "Time": 116.014383,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 68
 },
 {
   "No.": 102,
   "Time": 116.014384,
   "Source": "192.168.2.101",
   "Destination": "211.137.137.11",
   "Protocol": "UDP",
   "Length": 68
 }
]
</div>
		<script type="module">
			import {TrackballControls} from 'https://threejsfundamentals.org/threejs/resources/threejs/r119/examples/jsm/controls/TrackballControls.js';

			//Parse through the provided JSON (currenly residing in HTML. TODO: load from elsewhere)
			var  packetsJSON = JSON.parse(document.getElementById("data").innerHTML);
			
			//Create set of unique locations. Each will be represented by a sphere
			var uniqueLocations = new Set();
			for(var i = 0; i < Object.keys(packetsJSON).length; i++){
				uniqueLocations.add(packetsJSON[i].Source);
				uniqueLocations.add(packetsJSON[i].Destination);
			}
			var locationArray = Array.from(uniqueLocations);
		
			//Adds the 3 aspects vital to displaying anything: scene, camera and renderer
			//Also adds trackball controls
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight);
			document.body.appendChild( renderer.domElement );
			const controls = new TrackballControls(camera, document.getElementsByTagName("canvas")[0]);
			controls.rotateSpeed = 1.5;
			controls.zoomSpeed = 1.8;
			controls.panSpeed = 1.0;
			controls.keys = [ 65, 83, 68 ];
			
			//Adds spheres representing sources/destinations to the scene. TODO: needs labels with IP addresses
			var x0 = 0, y0 = 0;
			var radius = 8;
			var sphere, label, root;
			var sphereGeometry = new THREE.SphereBufferGeometry(0,32,32);
			var sphereMaterial = new THREE.MeshBasicMaterial({color: 0xffff00});
			var labelGeometry = new THREE.PlaneBufferGeometry(1, 1);
			var labelMaterial;
			var canvas, texture;
			
			for (var i = 0; i < locationArray.length; i++){
				sphere = new THREE.Mesh( sphereGeometry, sphereMaterial );
				canvas = makeLabelCanvas(50, locationArray[i]);;
				texture = new THREE.CanvasTexture(canvas);
			    texture.minFilter = THREE.LinearFilter;
			    texture.wrapS = THREE.ClampToEdgeWrapping;
			    texture.wrapT = THREE.ClampToEdgeWrapping;	
				labelMaterial = new THREE.MeshBasicMaterial({
					map: texture,
					side: THREE.DoubleSide,
					transparent: true,
				  });
				label = new THREE.Mesh(labelGeometry, labelMaterial);
				root = new THREE.Object3D();
				var x = x0 + radius * Math.cos(2 * Math.PI * i/uniqueLocations.size); //This makes all spheres equidistant in a circle
				var y = y0 + radius * Math.sin(2 * Math.PI * i/uniqueLocations.size);
				
				//Adding sphere and label to root element
				root.add(sphere);
				root.add(label);
				label.position.set(0,0,1);		//Need to place label further up z-axis relative to root, so it is not hidden by sphere
				scene.add(root);
				root.position.set(x,y,0);
				
				
			}
			camera.position.z = 20;
			
			function makeLabelCanvas(size, name) {
			  const borderSize = 2;
			  const ctx = document.createElement('canvas').getContext('2d');
			  const font =  `${size}px bold sans-serif`;
			  ctx.font = font;
			  // measure how long the name will be
			  const doubleBorderSize = borderSize * 2;
			  const width =  + doubleBorderSize;
			  const height = size + doubleBorderSize;
			  ctx.canvas.width = width;
			  ctx.canvas.height = height;
			 
			  // need to set font again after resizing canvas
			  ctx.font = font;
			  ctx.textBaseline = 'top';
			 
			  ctx.fillStyle = 'yellow';
			  ctx.fillRect(0, 0, width, height);
			  ctx.fillStyle = 'black';
			  ctx.fillText(name, borderSize, borderSize);
			 
			  return ctx.canvas;
			}	
			
			//Animation/rendering loop
			function animate() {
				requestAnimationFrame( animate );
				controls.update();
				renderer.render( scene, camera );
			}
			animate();			
			
		</script>
	</body>
</html>